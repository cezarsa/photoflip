!function(){var a;a=function(){function a(a){var b=this;0===a.width&&0===a.height?a.onload=function(){return b.init(a)}:this.init(a)}return a.prototype.minSquare=80,a.prototype.init=function(a){return this.img=a,this.img=a,this.totalWidth=a.width,this.totalHeight=a.height,this.placeholder=$('<div class="photoflip-image-placeholder">'),this.placeholder.css({width:this.totalWidth,height:this.totalHeight,backgroundColor:$(this.img).css("background-color")}),this.calculateSquares(),this.createFlippers(),$(this.img).replaceWith(this.placeholder)},a.prototype.calculateSquares=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(g=Math.floor(this.totalWidth/this.minSquare),f=this.totalWidth%this.minSquare,e=Math.floor(f/g),a=f%g,k=Math.floor(this.totalHeight/this.minSquare),j=this.totalHeight%this.minSquare,i=Math.floor(j/k),b=j%k,this.xSizes=[],this.ySizes=[],d=l=0;g>=0?g>l:l>g;d=g>=0?++l:--l)c=this.minSquare+e,a-->0&&(c+=1),this.xSizes.push(c);for(n=[],h=m=0;k>=0?k>m:m>k;h=k>=0?++m:--m)c=this.minSquare+i,b-->0&&(c+=1),n.push(this.ySizes.push(c));return n},a.prototype.createCanvas=function(){return this.canvas=$("<canvas>")[0],this.canvas.width=this.totalWidth,this.canvas.height=this.totalHeight,this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(this.img,0,0),this.pixelsData=this.ctx.getImageData(0,0,this.totalWidth,this.totalHeight).data},a.prototype.getMeanColor=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;for(e=0,i=h=g=0,k=l=b,n=d+b;n>=b?n>l:l>n;k=n>=b?++l:--l)for(j=m=a,o=c+a;o>=a?o>m:m>o;j=o>=a?++m:--m)f=4*k*this.totalWidth+4*j,i+=this.pixelsData[f],h+=this.pixelsData[f+1],g+=this.pixelsData[f+2],e++;return[Math.floor(i/e),Math.floor(h/e),Math.floor(g/e)]},a.prototype.createFlippers=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.createCanvas(),g=["right","left","top","bottom"],b=0,i=0,p=this.ySizes,r=[],l=0,n=p.length;n>l;l++){for(k=p[l],h=0,q=this.xSizes,m=0,o=q.length;o>m;m++)j=q[m],f=$('<div class="photoflip-flipper-container">'),e=$('<div class="photoflip-flipper">'),e.addClass(g[b++]),b%=g.length,d=$('<div class="photoflip-front photoflip-face">'),c=$('<div class="photoflip-back photoflip-face">'),a=this.getMeanColor(h,i,j,k),f.css({width:j,height:k}),d.css({backgroundImage:"url("+this.img.src+")",backgroundPosition:"-"+h+"px -"+i+"px"}),c.css({backgroundColor:"rgb("+a[0]+", "+a[1]+", "+a[2]+")"}),e.append(d),e.append(c),f.append(e),this.placeholder.append(f),h+=j;r.push(i+=k)}return r},a}(),window.PhotoFlip=a}.call(this);